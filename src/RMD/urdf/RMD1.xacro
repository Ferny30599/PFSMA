<?xml version="1.0"?>
<robot name="RMD1" xmlns:xacro="http://www.ros.org/wiki/xacro">
	<xacro:macro name="InerciaRueda">
	 <inertial>
		<origin
		xyz="1.9755E-05 -5.937E-05 0.010582"
		rpy="0 0 0" />
	   	<mass value="0.010874" />
		<inertia
		ixx="1.1208E-06"
		ixy="4.6507E-10"
		ixz="-7.7246E-10"
		iyy="1.1207E-06"
		iyz="-6.5341E-10"
		izz="1.5186E-06" />
	 </inertial>
	</xacro:macro>

  <!-- ::::::::::::::: ENLACES Y JUNTAS VISUALES DEL ROBOT :::::::::::::::-->
  <link
    name="base_link">
    <inertial>
      <!--origin
        xyz="0.00220064762445978 0.00632001835962821 0.0613684966384051" No funciona, se debe intercambiar el eje y por z -->
      <origin
        xyz="0.00220064762445978 -0.0613684966384051 0.00632001835962821"
        rpy="1.5708 0 0" />
      <mass
        value="0.187551651600364" />
      <inertia
        ixx="0.000236010414569773"
        ixy="-1.68515145672754E-09"
        ixz="1.38056969191708E-09"
        iyy="0.000507898725164958"
        iyz="-1.00879770741965E-05"
        izz="0.000308347840630502" />

    </inertial>
    <visual>
      <origin
        xyz="0 0 0"
        rpy="0 0 0" />
      <geometry>
        <mesh
          filename="package://RMD/meshes/base_link.STL" />
      </geometry>
      <material
        name="">
        <color
          rgba="0.752941176470588 0.752941176470588 0.752941176470588 1" />
      </material>
    </visual>
    <collision>
      <origin
        xyz="0 0 0"
        rpy="0 0 0" />
      <geometry>
        <mesh
          filename="package://RMD/meshes/base_link.STL" />
      </geometry>
    </collision>
  </link>
  <link
    name="Rueda_Izq">
    <xacro:InerciaRueda/>
    <visual>
      <origin
        xyz="0 0 0"
        rpy="0 0 0" />
      <geometry>
        <mesh
          filename="package://RMD/meshes/Rueda_Izq.STL" />
      </geometry>
      <material
        name="">
        <color
          rgba="0.79216 0.81961 0.93333 1" />
      </material>
    </visual>
    <collision>
      <origin
        xyz="0 0 0"
        rpy="0 0 0" />
      <geometry>
        <mesh
          filename="package://RMD/meshes/Rueda_Izq.STL" />
      </geometry>
    </collision>
  </link>
  <joint
    name="Motor_Izq"
    type="continuous">
    <origin
      xyz="-0.049569 -0.10759 -0.0043137"
      rpy="1.5708 -0.86735 -1.5708" />
    <parent
      link="base_link" />
    <child
      link="Rueda_Izq" />
    <axis
      xyz="0 0 1" />
    <dynamics
      damping="0.0001"
      friction="0.01" />
  </joint>
  <link
    name="Rueda_Der">
    <xacro:InerciaRueda/>
    <visual>
      <origin
        xyz="0 0 0"
        rpy="0 0 0" />
      <geometry>
        <mesh
          filename="package://RMD/meshes/Rueda_Der.STL" />
      </geometry>
      <material
        name="">
        <color
          rgba="0.79216 0.81961 0.93333 1" />
        <texture
          filename="package://RMD/textures/textura.jpg" />
      </material>
    </visual>
    <collision>
      <origin
        xyz="0 0 0"
        rpy="0 0 0" />
      <geometry>
        <mesh
          filename="package://RMD/meshes/Rueda_Der.STL" />
      </geometry>
    </collision>
  </link>
  <joint
    name="Motor_Der"
    type="continuous">
    <origin
      xyz="0.053971 -0.1076 -0.0044387"
      rpy="1.5708 -0.86667 1.5708" />
    <parent
      link="base_link" />
    <child
      link="Rueda_Der" />
    <axis
      xyz="0 0 -1" />
    <dynamics
      damping="0.0001"
      friction="0.01" />
  </joint>

<!--:::: SENSOR 1 ::::-->
<joint name="ultrasonic_joint" type="fixed">
  <origin xyz="0 0 0" rpy="0 0 0"/>
  <parent link="base_link"/>
  <child link="ultrasonic_sensor"/>
</joint>

<link name="ultrasonic_sensor">
  <inertial>
    <mass value="0.001"/>
    <origin xyz="0 0 0" rpy="0 0 0"/>
    <inertia ixx="0.000001" ixy="0.0" ixz="0.0" iyy="0.000001" iyz="0.0" izz="0.000001"/>
  </inertial>
  <collision>
    <origin xyz="0.002 0.005 0.05" rpy="0 0 0"/>
    <geometry>
      <box size="0.0475 0.015 0.02"/>
    </geometry>
  </collision>
  <visual>
    <origin xyz="0.002 0.005 0.05" rpy="0 0 0"/>
    <geometry>
      <box size="0.0475 0.015 0.02"/>
    </geometry>
  </visual>
  <gazebo reference="ultrasonic_sensor">
    <sensor type="sonar">
      <always_on>true</always_on>
      <update_rate>10.0</update_rate>
      <ray>
        <scan>
          <horizontal>
            <samples>1</samples>
            <resolution>1</resolution>
            <min_angle>0.1</min_angle>
            <max_angle>0.5</max_angle>
          </horizontal>
        </scan>
        <range>
          <min>0.02</min>
          <max>4.0</max>
          <resolution>0.001</resolution>
        </range>
      </ray>
      <plugin name="gazebo_ros_ultrasonic" filename="libgazebo_ros_range.so">
        <alwaysOn>true</alwaysOn>
        <updateRate>10.0</updateRate>
        <visualize>true</visualize>
        <rangeName>range</rangeName>
        <rangeNoise>0.01</rangeNoise>
        <rangeBias>0.0</rangeBias>
        <topicName>ultrasonic</topicName>
        <frameName>ultrasonic_frame</frameName>
      </plugin>
    </sensor>
  </gazebo>
</link>

 <!--:::: COLORES DEL MODELO ::::--> 
  <gazebo reference="Rueda_Izq">
 	<material>Gazebo/Red</material>
  </gazebo>
  <gazebo reference="Rueda_Der">
	<material>Gazebo/Red</material>
  </gazebo>
  <gazebo reference="base_link">
	<material>Gazebo/CoM</material>
  </gazebo>
  
  <!--:::: DECLARACION DE NODOS DE CONTROL ::::-->
  <gazebo>
    <plugin name="rdif1" filename="libgazebo_ros_diff_drive.so">
      <rosDebugLevel>Debug</rosDebugLevel>
      <publishWheelTF>false</publishWheelTF>
      <robotNamespace>/1</robotNamespace>
      <publishTf>1</publishTf>
      <publishWheelJointState>false</publishWheelJointState>
      <alwaysOn>true</alwaysOn>
      <updateRate>100</updateRate> 
      <leftJoint>Motor_Izq</leftJoint>
      <rightJoint>Motor_Der</rightJoint>
      <wheelSeparation>0.1244</wheelSeparation>
      <wheelDiameter>0.03</wheelDiameter>
      <broadcastTF>1</broadcastTF>
      <wheelTorque>0.1079</wheelTorque>
      <wheelAcceleration>1</wheelAcceleration>
      <commandTopic>cmd_vel1</commandTopic>
      <odometryFrame>odom1</odometryFrame> 
      <odometryTopic>odom1</odometryTopic> 
      <robotBaseFrame>base_link</robotBaseFrame>
    </plugin>
  </gazebo> 
</robot>

